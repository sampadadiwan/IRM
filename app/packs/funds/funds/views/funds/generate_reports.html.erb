<% 
  template_folder = @fund.entity.folders.where(name: "Portfolio Report Templates").first
  template_names = template_folder ? template_folder.documents.pluck(:name) : [] 
  start_date ||= params[:start_date] || (Date.today - 3.months).beginning_of_month
  end_date ||= params[:end_date] || Date.today.end_of_month
%>
<%= render NewCard.new do %>

  <%= render FormCard.new(title: "Generate Reports for #{@fund}") do %>

    <div class=" alert alert-danger text-center text-danger">
        Note that the data will be sent to an external LLM for report generation
    </div>

    <%= form_with(model: nil, url: generate_reports_fund_path(@fund), method: :post) do |form| %>
            
      <div class="form-group">
        <%= form.label :report_type %>
        <%= form.select :report_type, ["KpiReport"], {}, class: "form-control", name: "report_type"  %>
        <small class="form-text text-muted">Select the reports to generate.</small>
      </div>

      <div class="form-group">
        <%= form.label :report_template_name %>
        <%= form.select :report_template_name, template_names, {}, class: "form-control", name: "report_template_name"  %>
        <small class="form-text text-muted">Select the template to use for the report. (Templates must be uploaded to 'Portfolio Report Templates' folder)</small>
      </div>


      <div class="form-group">
        <%= form.label :start_date %>
        <%= form.date_field :start_date, class: "form-control", name: "start_date", value: start_date  %>
        <small class="form-text text-muted">Select the start date.</small>
      </div>

      <div class="form-group">
        <%= form.label :end_date %>
        <%= form.date_field :end_date, class: "form-control", name: "end_date", value: end_date  %>
        <small class="form-text text-muted">Select the end date.</small>
      </div>


      <div class="form-group">
        <%= form.label :include_kpis, "Include KPIs" %>
        <%= form.check_box :include_kpis, class: "form-check-input"  %>
        <small class="text-muted">Check this to include the KPIs for the dates input above, in the report</small>
      </div>

      <div class="form-group">
        <%= form.label :include_apis, "Include Portfolio Data" %>
        <%= form.check_box :include_apis, class: "form-check-input"  %>
        <small class="text-muted">Check this to include the Portfolio Investments data for the dates input above, in the report</small>
      </div>

      <div class="form-group">
        <%= form.submit "Generate Report Now", {class: "btn btn-outline-primary"}%>        
      </div>

      
    <% end %>

  <% end %>
  
<% end %>