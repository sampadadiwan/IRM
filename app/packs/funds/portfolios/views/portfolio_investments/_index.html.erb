<% aggregate_portfolio_investment ||= nil %>

<div class="d-sm-flex align-items-center justify-content-between mb-4">
  <h1 class="h3 mb-0 text-gray-800"><%= params[:title] || "Portfolio Investments" %></h1>

  <span>
    <% if aggregate_portfolio_investment && policy(aggregate_portfolio_investment).add_investment? %>
    
      <%= link_to "New Portfolio Investment",
          new_portfolio_investment_path("portfolio_investment[entity_id]": current_user.entity_id,
          "portfolio_investment[fund_id]": params[:fund_id],
          "portfolio_investment[portfolio_company_id]": params[:portfolio_company_id]),
          {class: "btn btn-outline-primary"} if params[:fund_id].present? %>


      <%= link_to "Upload",
          new_import_upload_path("import_upload[owner_id]": params[:fund_id],
          "import_upload[owner_type]": "Fund",
          "import_upload[import_type]": "PortfolioInvestment",
          "sample_upload": "PORTFOLIO_SAMPLE"),
          { class: "btn btn-outline-primary"}   %>


      <%= link_to "Download", portfolio_investments_path(fund_id: params[:fund_id], aggregate_portfolio_investment_id: aggregate_portfolio_investment&.id, format: "xlsx", all: true),  {class: "btn btn-outline-primary" } %>

    <% end %>

  </span>
</div>

<%=render SearchComponent.new %>

<div class="table-responsive">
    <table id="portfolio_investments" class="table table-bordered dataTable action_table hover">
        <% ransack_table_header = RansackTableHeader.new(PortfolioInvestment, q: @q, current_user: current_user, records: portfolio_investments, report_id: params["report_id"]) %>
        <%= render ransack_table_header %>
      <tbody>
        <% portfolio_investments.each do |portfolio_investment| %>
          <%= render "portfolio_investments/portfolio_investment",  portfolio_investment: portfolio_investment.decorate, columns: ransack_table_header.columns%>
        <% end %>
      </tbody>
    </table>
    <% if portfolio_investments.present? %>
      <%= page_entries_info portfolio_investments, entry_name: 'item' %>
      <%= paginate portfolio_investments %>
    <% end %>
</div>