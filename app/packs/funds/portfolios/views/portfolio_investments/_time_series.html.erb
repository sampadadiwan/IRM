<table class="table table-bordered dataTable action_table hover">
  <thead>
    <tr>
      <th>Portfolio Company</th>
      <th>Instrument</th>
      <th>Investment Date</th>
      <% dates = @time_series.values.flat_map { |data| data[:dates].keys }.uniq.sort %>
      <% dates.each do |date| %>
        <th colspan="<%= @fields.size %>"><%= l(date) %></th>
      <% end %>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <% dates.each do |_date| %>
        <% @fields.each do |field| %>
          <th><%= field.capitalize %></th>
        <% end %>
      <% end %>
    </tr>
  </thead>
  <tbody>
    <% @time_series.each do |investment_id, values| %>
      <% investment = values[:portfolio_investment] %>
      <% date_hash = values[:dates] %>
      <tr>
        <td><%= link_to investment.portfolio_company %></td>
        <td><%= link_to investment.investment_instrument %></td>
        <td><%= link_to(l(investment.investment_date), investment) %></td>
        <% dates.each do |date| %>
          <% @fields.each do |field| %>
            <td>
              <%= date_hash.dig(date, field).presence || "-" %>
            </td>
          <% end %>
        <% end %>
      </tr>
    <% end %>
  </tbody>
</table>
