<% 
  uri_params ||= {}
  portfolio_company_id = nil
  fund_id = nil
  # If this is part of the Fund Dashboard, we will get a fund object
  if @investor
    # If this is part of the Investor Dashboard, we will get an investor object
    portfolio_company_id ||= @investor.id 
  else
    fund ||= uri_params[:fund]
    fund_id ||= uri_params[:owner_id].presence || fund&.id
  end
  
  args ||= {}
  pi_uri = "/portfolio_investments?portfolio_company_id=#{portfolio_company_id}&fund_id=#{fund_id}"
  # add args as params to the url
  args.each do |key, value|
    pi_uri += "&#{key}=#{value}"
  end
  
  api_uri = "/aggregate_portfolio_investments?portfolio_company_id=#{portfolio_company_id}&fund_id=#{fund_id}&grid_only=true"
%>

<%= render(
      WidgetCardComponent.new(
        widget: widget,
        args: args,
        widget_size: widget.widget_size
      )
    ) do %>
  <!-- This block becomes the `content` inside the component -->
  <% if args[:ag] %>
      <%= turbo_frame_tag "portfolio_investments_frame", target: "_top", src: pi_uri, loading: :lazy do %>            
      <% end %>
  <% else %>
    <%= turbo_frame_tag "aggregate_portfolio_investments_frame", target: "_top", src: api_uri, lazy: true do %>            
    <% end %>
  <% end %>
<% end %>
