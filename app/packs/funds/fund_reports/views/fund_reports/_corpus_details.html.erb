<%
    if @fund_report.present?
        fund_report ||= @fund_report
    elsif params[:fund_report_id].present?
        fund_report ||= FundReport.where(id: params[:fund_report_id]).last
    elsif params[:id].present?
        fund_report ||= FundReport.where(fund_id: params[:id], name: params['report'].split('/').last.camelize).last
    end
    data = fund_report&.data
%>

<% unless fund_report && policy(fund_report).show? %>
    <div class="alert alert-danger" style="text-align: center;">Permission Denied</div>
<% end %>

<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h4 mb-0 text-gray-800" style="width:100%">Details of Capital Raised <%= "(#{fund_report.start_date.strftime("%-d %b, %Y")} - #{fund_report.end_date.strftime("%-d %b, %Y")})" %></h1>
    <span>
        <div class="btn-group">
            <div class="dropdown">
                <button class="btn btn-outline-primary dropdown-toggle" type="button"
                        data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    Actions
                </button>
                <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">

                    <%= button_to "Regenerate", regenerate_fund_report_path(id: fund_report.id),{class: "dropdown-item", method: :patch} if policy(fund_report).regenerate? %>
                    <%= button_to "Download", download_page_fund_report_path(id: fund_report.id, single: true),{class: "dropdown-item", method: :patch} if policy(fund_report).download_page? %>
                    <%= button_to "Download (All Funds)", download_page_fund_report_path(id: fund_report.id),{class: "dropdown-item", method: :patch} if policy(fund_report).download_page? %>
                    <%= button_to "Delete", fund_report, method: :delete, class: "dropdown-item", form_class: "deleteButton", data: {action: "click->confirm#popup", turbo:false} if policy(fund_report).destroy? %>

                </div>
            </div>
        </div>
    </span>
</div>

<div class="table-responsive">

<table id="capital_details" class="table table-bordered dataTable" style="width:100%">
    <tr>
       <th colspan="12" style="text-align: center;">
        Table 1:Details of Capital raised and invested
        </th>
    </tr>
        <tr>
            <th>S.No</th>
            <th>Name of Scheme (A)</th>
            <th>Total Commitment received as at the end of quarter (Corpus) (B)</th>
            <th>Gross Cumulative Funds raised as at the end of quarter (C)</th>
            <th>Cumulative Portfolio Investments made as at the end of quarte (D)</th>
            <th>Temporary investments made as at the end of quarter (E)</th>
            <th>Cash in hand as at the end of quarter (F)</th>
            <th>Cumulative Cost of Divestment made as at the end of quarter (G)</th>
            <th>Cumulative Principal/ Capital Distributions made to the investors as at the end of quarter (H)</th>
        </tr>
    <% if fund_report && policy(fund_report).show? %>

    <tr>
        <td>1</td>
        <td><%= data["Name of Schema"]["Value"] %></td>
        <td><%= data["Total Commitment received as at the end of quarter (Corpus) (Rs. Cr)"]["Value"] %></td>
        <td><%= data["Gross Cumulative Funds raised as at the end of quarter (Rs. Cr)"]["Value"] %></td>
        <td><%= data["Cumulative Portfolio Investments made as at the end of quarter(Rs. Cr)"]["Value"] %></td>
        <td><%= data["Temporary investments made as at the end of quarter (Rs. Cr)"]["Value"] %></td>
        <td><%= data["Cash in hand as at the end of quarter (Rs. Cr.)"]["Value"] %></td>
        <td><%= data["Cumulative Cost of Divestment made as at the end of quarter (Rs. Cr)"]["Value"] %></td>
        <td><%= data["Cumulative Principal/ Capital Distributions made to the investors as at the end of quarter (Rs. Cr)"]["Value"] %></td>
    </tr>
    <% end %>

</table>
</div>
