<%= render "/layouts/alerts" %>

  <table class="table table-bordered dataTable">

    <tr>
      <td>
        Entity
      </td>
      <td>
        <%= @capital_remittance.entity.name %>
      </td>
    </tr>
    <tr>
      <td>
        Fund
      </td>
      <td>
        <%= link_to @capital_remittance.fund.name, @capital_remittance.fund %>
      </td>
    </tr>
    <tr>
      <td>
        Capital Call
      </td>
      <td>
        <%= link_to @capital_remittance.capital_call.name, capital_call_path(@capital_remittance.capital_call, tab: "remittances-tab") %>
      </td>
    </tr>
    <tr>
      <td>
        Investor
      </td>
      <td>
        <%= link_to @capital_remittance.investor.investor_name, @capital_remittance.investor %>
      </td>
    </tr>
    <tr>
      <td>
        Status
      </td>
      <td>
        <%= render DisplayBooleanComponent.new(bool: @capital_remittance.status == "Paid").
        with_content(@capital_remittance.status) if @capital_remittance.status %>
      </td>
    </tr>

    <tr>
      <td>
        Verified
      </td>
      <td>
        <%= display_boolean(@capital_remittance.verified) %>
      </td>
    </tr>

    <tr>
      <td>
        Call Amount
      </td>
      <td>
        <%= money_to_currency @capital_remittance.call_amount, params %>
      </td>
    </tr>
    <tr>
      <td>
        Collected Amount
      </td>
      <td>
        <%= money_to_currency @capital_remittance.collected_amount, params %>
      </td>
    </tr>

    <tr>
      <td>
          Payment Proof
      </td>
      <td>
          <%= render "/layouts/attachments" , attachments: @capital_remittance.payment_proof if @capital_remittance.payment_proof.present? %>
      </td>
  </tr>

    <tr>
      <td>
        Notes
      </td>
      <td>
        <%= @capital_remittance.notes&.html_safe %>
      </td>
    </tr>

    <%= display_custom_fields(@capital_remittance) if current_user %>

  </table>


  <div>
    <% if policy(@capital_remittance).update? %>
      <% if @capital_remittance.entity_id == current_user.entity_id %>
        <%= link_to "Edit", edit_capital_remittance_path(@capital_remittance), {class: "btn btn-primary" } %>      
      <% else %>
        <%= link_to "Paid", edit_capital_remittance_path(@capital_remittance, status: "Paid"), {class: "btn btn-primary" } %>      
      <% end %>
    <% end %>

    <% label = @capital_remittance.verified ? "Unverify" : "Verify" %> 
    <% msg = @capital_remittance.verified ? "Mark as Unverified?" : "Mark as Verified?" %> 
    <%= button_to label, verify_capital_remittance_path(@capital_remittance), method: :patch, 
        class: "btn btn-success", form_class: "deleteButton", 
        data: {action: "click->confirm#popup", msg: msg, turbo:false, method: :patch} if policy(@capital_remittance).verify? && @capital_remittance.status=="Paid" %>

  </div>