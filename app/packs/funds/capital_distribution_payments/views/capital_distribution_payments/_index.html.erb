<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">Distribution Payments</h1>

    <span>
      <% capital_distribution ||= nil %>
      <% if capital_distribution %>
      
        <%= link_to "New Payment", 
          new_capital_distribution_payment_path("capital_distribution_payment[capital_distribution_id]": capital_distribution.id), 
          {class: "btn btn-outline-primary" }  %>

        <% disabled = capital_distribution.distribution_on != "Upload" ? "disabled" : nil %>
      
        <%= link_to "Upload", 
            new_import_upload_path("import_upload[owner_id]": capital_distribution.id, 
            "import_upload[owner_type]": "CapitalDistribution", 
            "import_upload[import_type]": "CapitalDistributionPayment", 
            "sample_upload": "CAPITAL_DISTRIBUTION_PAYMENT_SAMPLE"), 
            { class: "btn btn-outline-primary #{disabled}"}  %> 

        <%= link_to "Download" , 
          capital_distribution_payments_path(capital_distribution_id: capital_distribution.id, 
          format: "xlsx", all: true), {class: "btn btn-outline-success" } %>

      <% end %>
      <%#= render "/funds/search_bar", model_name: "capital_distribution_payment" %>
    </span>

</div>

  <% 
    lazy_load_data ||= false 
    import_upload_id ||= params[:import_upload_id]
  
    data_source ||= capital_distribution_payments_path(params: params.to_unsafe_h, import_upload_id:, format: :json, all: true) 

    col_params = {no_fund: true}
    if current_user.curr_role == "investor"
      col_params[:column_names] = CapitalDistributionPayment::INVESTOR_COLUMN_NAMES
      col_params[:column_fields] = CapitalDistributionPayment::INVESTOR_COLUMN_FIELDS
    end
    column_names, field_list = get_columns(CapitalDistributionPayment, params: col_params)   
  %>    
  

  <div class="table-responsive" data-controller="distribution-payments" data-distribution-payments-lazy-load-data-value=<%= lazy_load_data %> data-distribution-payments-table-name-value="#capital_distribution_payments"
  data-distribution-payments-field-list-value=<%=field_list%>>

    <% if lazy_load_data %>
        <a class="load_data_link" data-action="click->distribution-payments#loadData"><span>Load Data</span></a>
    <% end %>
    
    <%= render CustomTable.new(data_source:, id: "capital_distribution_payments", column_names:) %>

  </div>