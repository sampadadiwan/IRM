<% ckyc_data ||= @ckyc_data || @kyc_data %>
<% request_id ||= @request_id %>

<%= render NewCard.new do %>
  <%= render FormCard.new(title: "CKYC") do %>
    <div class="d-flex flex-column align-items-center gap-3">

      <%= form_tag download_ckyc_with_otp_kyc_data_path(id: ckyc_data.id, request_id: request_id, back_to: back_to), method: :put do %>
        <div class="form-group text-center">
          <%= label_tag :otp, "OTP" %>
          <%= text_field_tag :otp, nil, class: 'form-control text-center', style: "width: 300px;" %>
        </div>

        <div class="form-group text-center mt-3">
          <%= submit_tag "Submit", class: "btn btn-outline-primary" %>
        </div>
      <% end %>

      <!-- Resend OTP form with Stimulus -->
      <div data-controller="resend-otp" data-resend-otp-wait-time-value="90">
        <%= form_tag send_ckyc_otp_kyc_data_path(id: ckyc_data.id), method: :put, data: { resend_otp_target: "form", action: "submit->resend-otp#handleSubmit" } do %>
          <div class="form-group text-center">
            <%= submit_tag "Resend OTP", class: "btn btn-outline-secondary", data: { resend_otp_target: "button" }, disabled: true %>
            <div data-resend-otp-target="timer" class="mt-1 text-muted small"></div>
          </div>
        <% end %>
      </div>

    </div>
  <% end %>
<% end %>
