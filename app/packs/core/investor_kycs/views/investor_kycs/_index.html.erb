<% data_source ||= investor_kycs_path(params, format: :json, all: true) %>
<% lazy_load_data ||= false %>

  <div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">Investor Kycs</h1>

    <span>
      <% 
        entity_id = @investor ? @investor.entity_id : current_user.entity_id 
        investor_kyc = InvestorKyc.new(investor_id: @investor&.id, entity_id: entity_id)
      %>
      <%= link_to "New Investor Kyc" , new_investor_kyc_path("investor_kyc[investor_id]": @investor&.id, "investor_kyc[entity_id]": entity_id), {class: "btn btn-outline-primary" } if policy(investor_kyc).new? %>

      <%= link_to "Generate Kyc Docs", generate_all_docs_investor_kycs_path(entity_id:), class: "btn btn-outline-primary" if policy(investor_kyc).new? %>

      <div class="btn-group">
        <div class="dropdown">
          <button class="btn btn-outline-success dropdown-toggle" type="button"
                  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Upload/Download
          </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
      
            <%= link_to "Download", investor_kycs_path(investor_id: @investor&.id, format: "xlsx", all: true),  {class: "dropdown-item" }  %>

            <div class="dropdown-divider"></div>

            <%= link_to "Upload KYC Details",
              new_import_upload_path("import_upload[owner_id]": current_user.entity_id,
                  "import_upload[owner_type]": "Entity",
                  "import_upload[import_type]": "InvestorKyc",
                  "sample_upload": "INVESTOR_KYCS_SAMPLE"),
                  { class: "dropdown-item"}  %>

            <%= link_to "Upload KYC Documents",
              new_import_upload_path("import_upload[owner_id]": current_user.entity_id,
                  "import_upload[owner_type]": "Entity",
                  "import_upload[import_type]": "KycDocs",
                  "sample_upload": "INVESTOR_KYCS_DOCS_SAMPLE"),
                  { class: "dropdown-item"}  %>

          </div>
        </div>
      </div>
    </span>
  </div>

  <div class="table-responsive" data-controller="investor-kycs"
       data-investor-kycs-lazy-load-data-value=<%= lazy_load_data %>
       data-investor-kycs-table-name-value="#investor_kycs">

    <% if lazy_load_data %>
      <a class="load_data_link" data-action="click->investor-kycs#loadData"><span>Load Data</span></a>
    <% end %>

    <table id="investor_kycs" class="table table-bordered dataTable"
           data-source="<%= data_source %>" style="width:100%" >

      <thead>
        <tr>
          <th>
            Investor
          </th>
          <th>
            Full Name
          </th>
          <th>
            Pan
          </th>
          <th>
            Pan Verified
          </th>
          <th>
            Committed Amount
          </th>
          <th>
            Collected Amount
          </th>
          <th>
            Bank Verified
          </th>
          <th>
            Docs Completed
          </th>
          <th>
            KYC Verified
          </th>
          <th>
            Expired
          </th>

          <th>
          </th>
        </tr>
      </thead>

      <tbody>

      </tbody>
    </table>

  </div>
