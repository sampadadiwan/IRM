<div class="d-sm-flex align-items-center justify-content-between mb-4">
  <h1 class="h3 mb-0 text-gray-800">Investor Access Rights</h1>
  <%
    access_right ||= params[:entity_id].present? ? AccessRight.new(access_to_investor_id: params[:access_to_investor_id], owner_id: params[:owner_id], owner_type: params[:owner_type], entity_id: params[:entity_id]) : nil
  %>
  <span>
    <%= link_to "Grant Access", 
                  new_access_right_path(
                      "access_right[access_to_investor_id]": access_right.access_to_investor_id, 
                      "access_right[access_type]": access_right.access_type,
                      "access_right[owner_id]": access_right.owner_id,
                      "access_right[owner_type]": access_right.owner_type,
                      "access_right[entity_id]": access_right.entity_id,
                      form_type: params[:form_type]), 
                      { data: { turbo_frame: 'new_access_right' },
                      method: :get, class: "btn btn-outline-primary" } if access_right %> 

    <%= render "/funds/search_bar", model_name: "access_right" if access_right && access_right.owner_type == "Fund"%>
  </span>
</div>

<%= turbo_frame_tag "new_access_right" do %>
<% end %>

<%
  show_metadata ||= "Yes"
  show_for ||= "Yes"
%>
<div class="table-responsive">

  <table id="access_rights_table" class="table table-bordered table-striped dataTable jqDataTable">
    <thead>
      <tr>
        <th>
          Access To
        </th>
        <th class="hideMobP">
          Access Type
        </th>
        <% if show_metadata == "Yes" %>
          <th class="hideMobP">
            Metadata
          </th>
        <% end %>
        <% if show_for == "Yes" %>
          <th>
            For
          </th>
        <% end %>
        <th class="hideMobP">
        </th>
      </tr>
    </thead>

    <tbody id="access_rights_table_body">
      <% access_rights.each do |access_right| %>
        <%= render access_right, access_right: access_right, show_for: show_for, show_metadata: show_metadata %>
      <% end %>
    </tbody>

  </table>

</div>

<div class="alert alert-info text-center associated_entity">
  Access rights work at the level of the investor firm. To permission individuals from the investor firms
  please setup Stakeholder Users under a Stakeholder
</div>
