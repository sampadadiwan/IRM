<%= render "/layouts/alerts" %>

<div class="card shadow mb-4">
  <div class="card-header py-3 d-sm-flex align-items-center justify-content-between">
      <h6 class="m-0 font-weight-bold text-primary">Stakeholder: <%= @investor.investor_name %></h6>
      <span>
        <a class="btn btn-outline-primary show_details_link" data-bs-toggle="collapse" href=".show_details"><i class="fa-solid fa-caret-down"></i></a>
      </span>
  </div>
  <div class="card-body collapse show_details">

  <table class="table table-bordered dataTable ">

    <tr>
      <td>
        Name
      </td>
      <td>
        <%= @investor.investor_name %>
      </td>
    </tr>
    <tr>
      <td>
        Investee Entity
      </td>
      <td>
        <%= link_to @investor.entity.name, @investor.entity %>
      </td>
    </tr>
    <tr>
      <td>
        Investor Entity
      </td>
      <td>
        <%= link_to @investor.investor_entity.name, @investor.investor_entity %>
      </td>
    </tr>
    <tr>
      <td>
        Tags
      </td>
      <td>
        <%= raw @investor.tag_list.split(",")&.collect{|tag| link_to(tag, search_investors_path(query: tag))}.join(", ") if @investor.tag_list %>
      </td>    
    </tr>
    <tr>
      <td>
        Category
      </td>
      <td>
        <%= @investor.category %>
      </td>    
    </tr>

    <tr>
      <td>
        Primary Email
      </td>
      <td>
        <%= @investor.primary_email %>
      </td>    
    </tr>

    <tr>
      <td>
        PAN
      </td>
      <td>
        <%= @investor.pan %>
        <% if @investor.pan&.strip != @investor.investor_entity.pan&.strip %>
          <span class="badge bg-danger">Mismatched PAN, please contact support</span>
        <% end %>
      </td>    
    </tr>
    <tr>
      <td>
        City
      </td>
      <td>
        <%= @investor.city %>
      </td>    
    </tr>
    
    <%= display_custom_fields(@investor) if current_user %>

   
  </table>
  </div>

</div>

<div style=" display: inline-block;">
  <%= link_to "Edit" , edit_investor_path(@investor), {class: "btn btn-outline-primary" } if policy(@investor).update? %> 

  <%= link_to "View Notes" , notes_path(investor_id: @investor.id), class: "btn btn-outline-success" %> 
  <%= link_to "Add Note" , new_note_path("note[investor_id]": @investor.id), class: "btn btn-outline-success"if policy(@investor).update? %> 
  
  <%= button_to "Delete" , @investor, method: :delete, class: "btn btn-outline-danger" ,
      form_class: "deleteButton" , data: {action: "click->confirm#popup" , turbo: false} if policy(@investor).destroy? %>
</div>


<div id="access_rights" class="associated_entity">
  <%= render "/layouts/steps" , steps: ["Setup Stakehoder Details", "Grant Access Rights", "Add Stakehoder Users" , "Add/View Investments" , "Add/View Notes" ].freeze %>

  <%= render "investors/investor_details" , investor: @investor %>
</div>