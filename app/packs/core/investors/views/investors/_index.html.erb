<% 
  qs = params.to_enum.to_h
  qs[:format] = :json
  qs[:all] =  true
  data_source ||= investors_path(qs) 
%>    
<% lazy_load_data ||= false %>

<div class="d-sm-flex align-items-center justify-content-between mb-4">
  <% header=defined?(title) ? title : "Stakeholders" %>

    <h1 class="h3 mb-0 text-gray-800">
      <%= header %>
    </h1>

    <span>
    <% investor = Investor.new(entity_id: current_user.entity_id) %>
    <%= link_to "New Stakeholder" , new_investor_path("investor[entity_id]": current_user.entity_id),
      {class: "btn btn-outline-primary" } if policy(investor).new? %>

    <%= link_to "All Notes" , notes_path, {class: "btn btn-outline-success" } %>


    <div class="btn-group">
      <div class="dropdown">
        <button class="btn btn-outline-primary dropdown-toggle" type="button" 
                data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          Actions
        </button>
        <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
        
          <%= link_to "Download" , investors_path(format: "xlsx"),
            {class: "dropdown-item" } %>

          <%= link_to "Upload", 
            new_import_upload_path("import_upload[owner_id]": current_user.entity_id, 
                "import_upload[owner_type]": "Entity", 
                "import_upload[import_type]": "Investor", 
                "import_upload[entity_id]": current_user.entity_id,
                "sample_upload": "INVESTORS_SAMPLE"), 
                { class: "dropdown-item"} if policy(investor).upload? %> 
          
          

            <%= link_to "Add Stakeholder Notice" , 
                new_investor_notice_path( "investor_notice[owner_id]": current_user.entity_id, 
                                          "investor_notice[owner_type]": "Entity"), {class: "dropdown-item" } %>
      
        </div>
      </div>
    </div>

  </span>
</div>

<div class="table-responsive" data-controller="investors" data-investors-lazy-load-data-value=<%= lazy_load_data %> data-investors-table-name-value="#investors">

    <% if lazy_load_data %>
        <a class="load_data_link" data-action="click->commitments#loadData"><span>Load Data</span></a>
    <% end %>

    <% col_set = column_set(current_user, params[:cols]) %>
    <%= custom_columns(current_user, params[:cols]) %>
    
    <table id="investors" class="table table-bordered dataTable action_table hover" 
        data-source="<%= data_source %>" style="width:100%" >
      <thead>
        <tr>
          <% if col_set == "all" %>
          <th>
            Entity
          </th>
          <% end %>
          <th>
            Stakeholder
          </th>
          <th class="hideMobP hideTab">
            Tags
          </th>
          <th>
            Category
          </th>
          <th>
            City
          </th>
          <th class="hideMobP">
            Access
          </th>
          <th>
          </th>
        </tr>
      </thead>

      <tbody>
      </tbody>

    </table>

</div>
