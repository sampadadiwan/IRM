<div class="associated_entity" data-controller="tabs tabdetails datatable">

  <% label = investor.is_holdings_entity ? "#{investor.category} Stakeholders" : "Stakeholder User" %>

  <nav class="nav nav-tabs nav-fill nav-justified"  role="tablist">
    <a class="nav-link active" data-bs-toggle="pill" data-toggle="tab" href="#access-rights-tab">
          Access Rights
    </a>
    <a class="nav-link" data-bs-toggle="pill" data-toggle="tab" href="#investors-tab">
      <%= label %>
    </a>

    <% if investor.entity.enable_investments %>
    <a class="nav-link" data-bs-toggle="pill" data-toggle="tab" href="#investments-tab" 
          data-action="click->tabdetails#loadData">
        Investments
    </a>
    <% end %>

    <a class="nav-link" data-bs-toggle="pill" data-toggle="tab" href="#notes-tab" 
          data-action="click->tabdetails#loadData">
        Notes
    </a>

    <a class="nav-link" data-bs-toggle="pill" data-toggle="tab" href="#docs-tab"
    data-action="click->tabdetails#loadData">Documents</a>

    <a class="nav-link" data-bs-toggle="pill" data-toggle="tab" href="#reminders-tab" 
            data-action="click->tabdetails#loadData">
      Reminders
    </a>
    <a class="nav-link" data-bs-toggle="pill" data-toggle="tab" href="#tasks-tab" 
          data-action="click->tabdetails#loadData">
        Tasks
    </a>

    <% if investor.entity.enable_investor_kyc %>
      <a class="nav-link" data-bs-toggle="pill" data-toggle="tab" href="#kycs-tab" 
            data-action="click->tabdetails#loadData">
          KYC
      </a>
    <% end %>
    
  </nav>

  <div class="tab-content" data-controller="datatable">
      <div id="access-rights-tab" class="tab-pane fade in show active">
        <div id="access_rights" class="associated_entity">
          <%= render "/access_rights/index", access_rights: AccessRight.includes(:owner, :investor).for_investor(investor).includes(:owner, :investor), access_right: nil %>
        </div>
      </div>
      <div id="investors-tab" class="tab-pane fade">
        <div id="investor_accesses" class="associated_entity">
          <%= render "/investor_accesses/index", investor_accesses: investor.investor_accesses.includes(:user), 
              investor: investor, label: label %>
        </div>     
      </div>

      <div id="investments-tab" class="tab-pane fade">
        <div id="investments" class="associated_entity">
          <%= link_to investments_path(investor_id: investor.id), class: "load_data_link", data: { turbo_frame: 'investments_frame' } do %>
            <span>Loading...</span>
          <% end %>
          <%= turbo_frame_tag "investments_frame", target: "_top" do %>
          <% end %>
        </div>     
      </div>

      <div id="notes-tab" class="tab-pane fade">
        <div id="notes" class="associated_entity">
          <%= link_to notes_path(investor_id: investor.id), class: "load_data_link", data: { turbo_frame: 'notes_frame' } do %>
            <span>Loading...</span>
          <% end %>
          <%= turbo_frame_tag "notes_frame", target: "_top" do %>
          <% end %>
        </div>     
      </div>

      <div id="tasks-tab" class="tab-pane fade">
        <div id="tasks" class="associated_entity">
          <%= link_to tasks_path(for_entity_id: investor.investor_entity_id), class: "load_data_link", data: { turbo_frame: 'task_list' } do %>
            <span>Loading...</span>
          <% end %>
          <%= turbo_frame_tag "task_list", target: "_top" do %>
          <% end %>
        </div>     
      </div>

      <div id="reminders-tab" class="tab-pane fade">
        <div id="reminders" class="associated_entity">
          <%= link_to reminders_path( owner_id: investor.id, owner_type: "Investor", sent: false), 
                                  class: "load_data_link", 
                                  data: { turbo_frame: 'reminders_list' } do %>
            <span>Loading...</span>
          <% end %>
          <%= turbo_frame_tag "reminders_list", target: "_top" do %>
          <% end %>
        </div>     
      </div>


      <div id="kycs-tab" class="tab-pane fade">
        <div id="kycs" class="associated_entity">
          <%= link_to investor_kycs_path( investor_id: investor.id), 
                                  class: "load_data_link", 
                                  data: { turbo_frame: 'investor_kycs_list' } do %>
            <span>Loading...</span>
          <% end %>
          <%= turbo_frame_tag "investor_kycs_list", target: "_top" do %>
          <% end %>
        </div>     
      </div>


      <div id="docs-tab" class="tab-pane fade">
        <div id="docs" class="associated_entity">

          <%= link_to documents_path(owner_id: investor.id, owner_type: "Investor", 
                                     entity_id: investor.entity_id, no_folders: true), 
                                     class: "load_data_link", 
                                     data: { turbo_frame: 'documents_frame' } do %>
              <span>Loading...</span>
          <% end %>
          <%= turbo_frame_tag "documents_frame", target: "_top" do %>
          <% end %>
        </div>     
      </div>

  </div>

</div>
