<% params[:units] = "Million" %>

<% unless current_user.investor_advisor? %>
    <% cache([current_user.entity, "FMDashBoardStats"], expires_in: 24.hour) do %>
        <%= render "entities/fm_dashboard_stats" %>
    <% end %>
<% end %>

<%= render "entities/fm_dashboard_menus" %>

<div data-controller="datatable">

    <% cache_if(current_user != nil, [current_user&.entity, current_user&.curr_role, params[:page]], expires_in: 5.day) do %>

        <% if current_user.enable_funds %>
            <% title = link_to("Funds", funds_path) %>
            <%= render ToggleCard.new(title:, css_class: "show_funds") do %>
                <% funds = policy_scope(Fund).page(params[:page]) %>

                <% funds.each do |fund| %>
                    <%= render "/funds/card", fund: %>
                <% end %>

                <%= paginate funds %>
            <% end %>

        <% end %>

    
        <% investment_opportunities = policy_scope(InvestmentOpportunity) %>
        <% if investment_opportunities.count > 0 %>
            <%= render ToggleCard.new(title: "Investment Opportunities", css_class: "show_ios") do %>
                <% investment_opportunities.each do |investment_opportunity| %>
                    <%= render "investment_opportunities/card", investment_opportunity: investment_opportunity %>
                <% end %>
            <% end %>
        <% end %>

    <% end %>

</div>