<%
  hidden_fields ||= {}
  disabled ||= false
  state ||= "show"
  css_class||= "show_filter"
%>
<% if params[:filter].present? || params[:q].present? || params[:ag].present? %>

  <%= render ToggleCard.new(title: "Filter", css_class: css_class, controller: "filter", state: state) do %>

    <% @q.build_condition if @q.conditions.empty? %>

    <% if disabled %>
      <!-- Disable the form if the disabled flag is set -->
      <fieldset disabled="disabled">
        <%= search_form_for @q, method: :post do |f| %>
          <%= render "/funds/filter" %>
          <%= f.condition_fields do |c| %>
            <%= render "/layouts/condition_fields", f: c, associations: associations %>
          <% end %>
        <% end %>
      </fieldset>
    <% else %>
      <%= search_form_for @q, method: :post do |f| %>
          <%= render "/funds/filter" %>
          <%= f.condition_fields do |c| %>
            <%= render "/layouts/condition_fields", f: c, associations: associations %>
          <% end %>

          <div class="action float-end">

            <% if false && %w[capital_commitments account_entries].include?(params[:controller]) %>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" id="ag_grid" name="ag" value="true" <%= params[:ag].present? ? "checked" : nil %> >
              <label class="form-check-label" for="ag_grid">Enable Pivots</label>
            </div>
            <% end %>

            <% if %w[kpis kpi_reports].include?(params[:controller]) %>
            <div class="form-check form-check-inline">
              <input class="form-check-input" type="checkbox" id="grid_view" name="grid_view" value="true" <%= params[:grid_view].present? ? "checked" : nil %> >
              <label class="form-check-label" for="grid_view">Grid View</label>
            </div>
            <% end %>

            <%= f.button "", class: "btn btn-outline-primary search-button", "data-bs-toggle": "tooltip", "data-bs-placement": "top", title: "Search" do %>
              <i class="ti ti-search"></i>
            <% end %>

            <%= link_to_add_fields '<i class="ti ti-plus"></i>'.html_safe, f, :condition, associations %>

            <%= link_to new_report_path, class: "btn btn-outline-info", "data-bs-toggle": "tooltip", "data-bs-placement": "top", title: "Save Report" do %>
              <i class="ti ti-database"></i>
            <% end %>
          </div>

          <% hidden_fields.each do |key, value| %>
            <%= hidden_field_tag key, value if value %>
          <% end %>

      <% end %>
    <% end %>
    <!-- End of ToggleCard -->
  <% end %>
<% end %>
