<%= form_with(model: nil, method: :get, url: set_persona_users_path, id: "persona_form") do |form| %>
  <% 
    personas = []

    if current_user.has_cached_role?(:company) 
      personas << ["My Company", :company] 
    end

    if current_user.has_cached_role?(:investor) 
      personas << ["My Investments",:investor] 
    end

    if current_user.has_cached_role?(:holding) 
      personas << ["My Holdings", :holding] 
    end

    if current_user.has_cached_role?(:consultant) 
      personas << ["Consultant", :consultant] 
      if personas.length == 1 && current_user.roles.count > 1
        personas << ["Default", current_user.roles.first.name.to_sym] 
      end
    end

    
  %>
  <div class="form-group" data-controller="persona">
    <% selected = params[:persona].present? ? params[:persona] : current_user.curr_role.to_sym %>
    <%= form.select :persona, personas, {selected: selected}, 
        { id: "persona", class: "form-control", 
        data: { action: "change->persona#setPersona", toggle: "tooltip", title: "Choose Persona" } } %>
  </div>

  
  <%= form.submit "Submit", {hidden: true, id: "submit"}%>


<% end %>