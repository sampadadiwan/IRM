<%
    progressbar ||= false
    steps = []
    params[:force_units] = offer.entity.default_currency_units
    if params[:force_units] == "Crores" && offer.amount.to_d < 100_00000
        # If committed_amount is less than a crore, then show in lakhs
        params[:force_units] = "Lakhs"
    end
%>

<% if policy(offer).update? && offer.approved %>

  <%

  steps = [t('secondaries_actions.complete_offer_details_button').html_safe,
          t('secondaries_actions.upload_documents_complete_offer').html_safe,
          t('secondaries_actions.wait_communication', entity_name: offer.secondary_sale.entity.name)].freeze

  %>

  <%= render "/layouts/steps", steps:  %>

<% elsif policy(offer).show? && offer.verified %>


  <%
    spas = []
    offer.documents.where(owner_tag: "Generated", approved: true).each do |spa|
      spas << link_to(spa.name, spa.file.url, target: "_blank", class: "btn btn-outline-primary ti ti-file-text")
    end

    if spas.present?
      accept_spa = button_to("Accept" , accept_spa_offer_path(offer), method: :patch,
          class: "btn btn-outline-primary ti ti-check" , id: 'accept_spa_btn',
          form_class: "deleteButton",data: {action: "click->confirm#popup", method: :patch,
          msg: "This will mark your acceptance of the Transaction Document(s). Proceed?"}) if policy(offer).accept_spa?
              
      steps = [t('secondaries_actions.review_transaction_documents', documents: spas.join(' ')).html_safe,
              t('secondaries_actions.accept_transaction_documents_button', accept_button: accept_spa).html_safe,
              (t('secondaries_actions.acceptance_recorded').html_safe unless policy(offer).accept_spa? ),
              t('secondaries_actions.wait_communication', entity_name: offer.secondary_sale.entity.name)].compact
    else
      steps = [t('secondaries_actions.offer_being_processed'), t('secondaries_actions.next_step_accept_documents'), t('secondaries_actions.wait_communication', entity_name: offer.secondary_sale.entity.name)]
    end
  %>

  <%= render "/layouts/steps", steps:, progressbar:  %>

<% end %>