<%= render "/layouts/alerts" %>

<div class="d-sm-flex align-items-center justify-content-between mb-4" data-controller="nudge">
    <h1 class="h3 mb-0 text-gray-800">Deal Grid View</h1>
    <span>
        <% if params[:all].blank? %>
            <%= link_to "All Investors", deal_path(id: @deal.id, grid_view: true, all:true), {class: "btn btn-primary"}  %>
        <% else %>
            <%= link_to "Not Declined", deal_path(id: @deal.id, grid_view: true), {class: "btn btn-primary"}  %>
        <% end %>

        <a class="btn btn-success", data-action="click->nudge#newDealMsg">Send Message</a>
        <%= link_to new_nudge_path(), id: "new_nudge", hidden: true do %>
            <span>Loading...</span>
        <% end %>
        <%= link_to deal_path(id: @deal.id, grid_view: true, all:true, format: :xlsx), {class: "btn btn-success"} do %>
            <i class="fa-lg fa-regular fa-file-excel"></i> Download
        <% end %>
    </span>
</div>

<div id="deal_grid_div" data-controller="datatable">
    <table id="deal_grid_view" class="table table-bordered dataTable" >
        <thead>
            <tr>
                <th></th>
                <th>Investor</th>
                <th>Pre Money Valuation</th>
                <th>Primary</th>
                <th>Secondary</th>
                <% DealActivity.templates(@deal).each do |deal_activity| %>
                    <th> <%= deal_activity.title %> </th>
                <% end %>
                <th>Company Advisor</th>
                <th>Investor Advisor</th>
                
            </tr>
        </thead>
        <tbody>
            <% @deal_investors.includes(:investor, :deal_activities).each do |deal_investor| %>
                <%= render "deals/grid_view_row", deal_investor: deal_investor %>
            <% end %>
        </tbody>
    </table>
</div>

<%= render "/deals/deal_details", deal: @deal, show_investors: "No" %>
