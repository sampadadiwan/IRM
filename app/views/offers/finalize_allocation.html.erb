<%= render "/secondary_sales/stats", secondary_sale: @secondary_sale %>


<div class="d-sm-flex align-items-center justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800">Finalize Offer Allocations</h1>

    <span>
        
        <%= link_to "All Offers", finalize_allocation_offers_path(secondary_sale_id: @secondary_sale.id), 
                {class: "btn btn-primary" }  %> 
        <%= link_to "Verified", finalize_allocation_offers_path( secondary_sale_id: @secondary_sale.id, 
                                                verified: true), 
                {class: "btn btn-success" }  %> 
        <%= link_to "Un-Verified", finalize_allocation_offers_path( secondary_sale_id: @secondary_sale.id, 
                                                verified: false), 
                {class: "btn btn-warning" }  %> 
                
        &nbsp;&nbsp;&nbsp;

        <% if @secondary_sale %>
            <% download_disabled =  @secondary_sale.allocation_status == 'Completed' ? nil : 'disabled' %>

            <%= link_to download_secondary_sale_path(@secondary_sale, format: "xlsx"), 
                                                    {class: "btn btn-success #{download_disabled}"  } do %> 
                    <i class="fa-lg fa-regular fa-file-excel"></i> Download
            <% end %>
        
            &nbsp;&nbsp;&nbsp;
      
            <%= link_to "Interest Allocations",
              interests_path(secondary_sale_id: @secondary_sale.id, finalize_allocation: true), 
              {class: "btn btn-success" } if policy(@secondary_sale).view_allocations? %> 
              
            <% label = @secondary_sale.lock_allocations ? 'Unlock Allocations' : 'Lock Allocations' %>
            <%= link_to label , lock_allocations_secondary_sale_path(@secondary_sale),    
                        class: "btn btn-danger" if policy(@secondary_sale).lock_allocations? %> 
        
        <% end %>
        <form class="d-sm-inline-block form-inline navbar-search" action="<%= search_offers_path %>">
            <div class="input-group">
                <input name="query" type="text" class="form-control border-0 small" placeholder="Search for..." value="<%= params[:query] %>" aria-label="Search" aria-describedby="basic-addon2">
                <input type="hidden" name="secondary_sale_id" value="<%= @secondary_sale.id %>">
                <input type="hidden" name="finalize_allocation" value="true">
            </div>
        
        </form>        
    </span>
</div>

<div class="table-responsive">

<div class="divTable minimalistBlack">
    <div class="divTableHeading datatable jqDataTable">
        <div class="divTableRow thead">
            <div class="divTableHead">Approved</div>
            <div class="divTableHead">User</div>
            <div class="divTableHead">Quantity</div>
            <div class="divTableHead">Holding %</div>
            <div class="divTableHead">PAN</div>
            <div class="divTableHead">Bank</div>
            <div class="divTableHead">Docs & Signature</div>
            <div class="divTableHead">Allocation Amount</div>
            <div class="divTableHead">Allocation %</div>
            <div class="divTableHead">Allocation Quantity</div>
            <div class="divTableHead">Aquirer</div>
            <div class="divTableHead">Accepted SPA</div> 
            <div class="divTableHead">Verifed</div>            
            <div class="divTableHead">Comments</div>
            <div class="divTableHead">Action</div>
        </div>
    </div>
    <div class="divTableBody tbody">
        <% @offers.each do |offer| %>
            <%= render "offers/final_offer", offer: offer %>
        <% end %>        
    </div>
    
</div>

<%= paginate @offers %>

</div>