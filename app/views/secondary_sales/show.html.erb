<%= render "/layouts/alerts" %>

  <table class="table table-bordered dataTable">

    <tr>
      <td>
        Name
      </td>
      <td>
        <%= @secondary_sale.name %>
      </td>
    </tr>
    <tr>
      <td>
        Total Offered
      </td>
      <td>
        <%= @secondary_sale.total_offered_quantity %>
      </td>
    </tr>
    <tr>
      <td>
        Entity
      </td>
      <td>
        <%= @secondary_sale.entity.name %>
      </td>
    </tr>
    <tr>
      <td>
        Start Date
      </td>
      <td>
        <%= l @secondary_sale.start_date %>
      </td>
    </tr>
    <tr>
      <td>
        End Date
      </td>
      <td>
        <%= l @secondary_sale.end_date %>
      </td>
    </tr>
    <% unless Pundit.policy(current_user, @secondary_sale).show_interest? %>
      <tr id="percent_allowed">
        <td>
          Percent Allowed
        </td>
        <td>
          <%= @secondary_sale.percent_allowed %> %
        </td>
      </tr>
    <% end %>
    <tr>
      <td>
        Min Price
      </td>
      <td>
        <%= @secondary_sale.min_price %>
      </td>
    </tr>
    <tr>
      <td>
        Max Price
      </td>
      <td>
        <%= @secondary_sale.max_price %>
      </td>
    </tr>
    <tr>
      <td>
        Active
      </td>
      <td>
        <%= @secondary_sale.active? ? "Yes" : "No" %>
      </td>
    </tr>
    <tr id="visible_externally">
      <td>
        Visible Externally
      </td>
      <td>
        <%= @secondary_sale.visible_externally ? "Yes" : "No" %>
      </td>
    </tr>

    <tr>
      <td>
        Public Files: Viewable by all buyers
      </td>
      <td>
        <ul>
          <% @secondary_sale.public_docs.each do |file| %>
            <li>
              <%= link_to rails_blob_path(file, disposition: :attachment), class: "btn btn-sm btn-primary" do%>
                <i class="fas fa-download"></i>
                <%= file.filename.to_s.capitalize %>
              <% end %>
            </li>
          <% end %>
        </ul>
      </td>
    </tr>

    <% if Pundit.policy(current_user, @secondary_sale).see_private_docs?  %>
    <tr>
      <td>
        Private Files: Viewable only by shortlisted buyers
      </td>
      <td>
        <ul>
          <% @secondary_sale.private_docs.each do |file| %>
            <li>
              <%= link_to rails_blob_path(file, disposition: :attachment), class: "btn btn-sm btn-warning" do%>
                <i class="fas fa-download"></i>
                <%= file.filename.to_s.capitalize %>
              <% end %>
            </li>
          <% end %>
        </ul>
      </td>
    </tr>
    <% end %>


  </table>


  <div>
    <% if Pundit.policy(current_user, @secondary_sale).update? %>
      <%= link_to "Edit" , edit_secondary_sale_path(@secondary_sale), {class: "btn btn-primary" } %> |
      <% label = @secondary_sale.visible_externally ? "Hide Externally" : "Make Visible Externally" %>
      <%= button_to label , make_visible_secondary_sale_path(@secondary_sale), method: :patch, class: "btn btn-success" , form_class: "deleteButton" %> |
      <%= button_to "Delete" , @secondary_sale, method: :delete, class: "btn btn-danger" , form_class: "deleteButton" %>
    <% end %>
  </div>

  <%= render "/secondary_sales/secondary_sale_details" , secondary_sale: @secondary_sale %>