<%= render "/layouts/alerts" %>

  <%= render "/secondary_sales/show", secondary_sale: @secondary_sale %>


  <div>
    <% if policy(@secondary_sale).update? %>
      <%= link_to "Edit" , edit_secondary_sale_path(@secondary_sale), {class: "btn btn-primary" } %> 

      <% download_disabled =  @secondary_sale.allocation_status == 'Completed' ? nil : 'disabled' %>
      <%= link_to "Download Details XL" , download_secondary_sale_path(@secondary_sale, format: "xlsx"), 
              {class: "btn btn-success #{download_disabled}"  } if @secondary_sale.allocation_status.present? %> 

      <%= link_to "Allocate Sale" , allocate_secondary_sale_path(@secondary_sale), {class: "btn btn-success" } %> 
      <%= link_to "Send Allocation Notification" , notify_allocation_secondary_sale_path(@secondary_sale), {class: "btn btn-success" } if @secondary_sale.allocation_status == "Completed" %> 
      
      <% label = @secondary_sale.visible_externally ? "Hide Externally" : "Make Visible Externally" %>
      <%= button_to label , make_visible_secondary_sale_path(@secondary_sale), method: :patch, class: "btn btn-success" , form_class: "deleteButton" %> 
      
      <%= button_to "Delete" , @secondary_sale, method: :delete, class: "btn btn-danger" , form_class: "deleteButton", data: {action: "click->confirm#delete", turbo:false}  %>
      
    <% end %>
  </div>

  <%= render "/layouts/steps", steps: ["Setup Access Rights", "View / Approve Offers", "View / Shortlist Interests"].freeze if @secondary_sale.entity_id == current_user.entity_id %>

  <%= render "/secondary_sales/secondary_sale_details" , secondary_sale: @secondary_sale %>