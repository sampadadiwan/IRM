<div class="associated_entity" data-controller="tabs">

  <%
    holdings_active = false
    offers_active = false
    interests_active = false
    access_right_active = false
  %>

  <nav class="nav nav-tabs nav-fill nav-justified"  role="tablist">
    <% if current_user.entity_id == secondary_sale.entity_id %>
      <% holdings_active = true %>
      <a class="nav-link <%= holdings_active ? 'active' : '' %>" data-bs-toggle="pill" data-toggle="tab" href="#holdings-tab">Holdings</a>
      <a class="nav-link" data-bs-toggle="pill" data-toggle="tab" href="#offerings-tab">Offers</a>
      <a class="nav-link" data-bs-toggle="pill" data-toggle="tab" href="#interests-tab">Interests</a>
      <a class="nav-link" data-bs-toggle="pill" data-toggle="tab" href="#access-rights-tab">Access Rights</a>
    <% elsif current_user.has_cached_role?(:holding) %>
      <% holdings_active = true %>
      <a class="nav-link <%= holdings_active ? 'active' : '' %>" data-bs-toggle="pill" data-toggle="tab" href="#holdings-tab">Holdings</a>
      <a class="nav-link" data-bs-toggle="pill" data-toggle="tab" href="#offerings-tab">Offers</a>      
    <% elsif current_user.has_cached_role?(:secondary_buyer) %>
      <% interests_active = true %>
    <% end %>
  </nav>

  <div class="tab-content">
      <div id="access-rights-tab" class="tab-pane fade">
        <div id="access_rights" class="associated_entity">
          <% access_right = AccessRight.new(
              owner_id: secondary_sale.id, 
              access_type: "SecondarySale", 
              owner_type: "SecondarySale", 
              entity_id: secondary_sale.entity_id) %>
              
          <%= render "/access_rights/index", access_rights: AccessRight.for_secondary_sale(secondary_sale), access_right: access_right %>
        </div>
      </div>
      <div id="offerings-tab" class="tab-pane fade">
        <div id="offerings" class="associated_entity">
          <% offers = current_user.entity_id == secondary_sale.entity_id ? secondary_sale.offers : secondary_sale.offers.where(user_id: current_user.id) %>
          <%= render "/offers/index", offers: offers, secondary_sale: secondary_sale, show_entity:false, show_secondary_sale:false  %>
        </div>     
      </div>

      <div id="interests-tab" class="tab-pane fade <%= interests_active ? 'in show active' : '' %>">
        <div id="interests" class="associated_entity">
          <% interests = current_user.entity_id == secondary_sale.entity_id ? secondary_sale.interests : secondary_sale.interests.where(user_id: current_user.id) %>
          <%= render "/interests/index", interests: interests, secondary_sale: secondary_sale  %>
        </div>     
      </div>

      <div id="holdings-tab" class="tab-pane fade <%= holdings_active ? 'in show active' : '' %>">
        <div id="holdings" class="associated_entity">
          <% holdings = current_user.entity_id == secondary_sale.entity_id ? current_user.entity.holdings : current_user.holdings.where(entity_id: secondary_sale.entity_id) %>
          <%= render "/holdings/index", holdings: holdings, secondary_sale: secondary_sale  %>
        </div>     
      </div>
  </div>

</div>