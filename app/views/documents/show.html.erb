<%= render "/layouts/alerts" %>


<div class="row">

    <div class="col-lg-12 mb-4">

        <!-- Illustrations -->
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">
                   Document
                   : <%= pluralize @document.impressionist_count(), "View" %>

               </h6>
            </div>
            <div class="card-body">
               <table class="table table-bordered dataTable ">
                  <tr>
                     <td>
                        Download
                     </td>
                     <td>
                        <%= link_to @document.name, @document.file.expiring_url() if @document.file.exists? %>
                        <%= link_to @document.name, rails_blob_path(@document.video, disposition: "attachment") if @document.video.present? %>                     
                     </td>
                  </tr>
                  <tr>
                     <td>
                        Created
                     </td>
                     <td>
                        <%= l @document.created_at, format: :default %>
                  </tr>
                  <tr>
                     </td>    
                     <td>
                        Entity
                     </td>
                     <td>
                        <%= link_to @document.entity.name, @document.entity %>

                     </td>
                  </tr>
                  
                  <% if @document.text.present? %>
                  <tr>
                     <td>
                        Details
                     </td>
                     <td>
                        <%= @document.text %>
                        
                     </td>
                  </tr>
                  <% end %>

               </table>

            </div>
        </div>
    </div>
</div>
<div class="row">
    <% if  @document.video.present? || @document.video? %>
    <div class="col-lg-12 mb-4">
        <!-- Approach -->
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Video</h6>
            </div>
            <div class="card-body">
            
               <video
                  id="document_video"
                  class="document_video vjs-fill"
                  controls="true"
                  responsive="true"
                  preload="false"
                  data-setup="{}"
               >
                  <source src="<%= @document.video.present? ? @document.video.url : @document.file.expiring_url %>" />
                  <p class="vjs-no-js">
                     To view this video please enable JavaScript, and consider upgrading to a
                     web browser that
                     <a href="https://videojs.com/html5-video-support/" target="_blank"
                     >supports HTML5 video</a
                     >
                  </p>
               </video>
               
            </div>
        </div>
    </div>
   <% end %>

</div>



<% if current_user.entity_id == @document.entity_id %>
   <div style="display: inline-block;">
      <%= link_to "Edit", edit_document_path(@document), {class: "btn btn-primary"} %> |
       <%= button_to "Delete", @document, method: :delete, class: "btn btn-danger", form_class: "deleteButton" %> 
   </div>

   <%= turbo_frame_tag "new_access_right" do %>
      
      | <%= link_to "Grant Access", 
      new_access_right_path("access_right[owner_id]": @document.id,
                            "access_right[access_type]": "Document",
                            "access_right[owner_type]": "Document",
                            "access_right[entity_id]": @document.entity_id), 
            {  method: :get, class: "btn btn-primary" } %> 


   <% end %>
   

   <div id="access_rights" class="associated_entity">
      <%= render "/access_rights/index", access_rights: @document.access_rights %>
   </div>

   <div data-controller="access"></div>

<% end %>