$.fn.AdminSettings = function (settings) {
  var myid = this.attr("id");
  // default settings
  var defaults = {
    Layout: "vertical",
    SidebarType: "full",
    BoxedLayout: true, // it can be true / false
    Direction: "ltr",
    Theme: "light",
    ColorTheme: "Blue_Theme",
    cardBorder: false,
  };
  var settings = $.extend({}, defaults, settings);

  // Attribute functions
  var AdminSettings = {
    // Settings INIT
    AdminSettingsInit: function () {
      AdminSettings.ManageThemeLayout();
      AdminSettings.ManageSidebarType();
      AdminSettings.ManageBoxedLayout();
      AdminSettings.ManageDirectionLayout();
      AdminSettings.ManageDarkThemeLayout();
      AdminSettings.ManageColorThemeLayout();
      AdminSettings.ManageCardLayout();
    },

    setCookie: function(name,value,days) {
      var expires = "";
      if (days) {
          var date = new Date();
          date.setTime(date.getTime() + (days*24*60*60*1000));
          expires = "; expires=" + date.toUTCString();
      }
      document.cookie = name + "=" + (value || "")  + expires + "; path=/";
    },
    getCookie: function(name) {
        var nameEQ = name + "=";
        var ca = document.cookie.split(';');
        for(var i=0;i < ca.length;i++) {
            var c = ca[i];
            while (c.charAt(0)==' ') c = c.substring(1,c.length);
            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
        }
        return null;
    },

    eraseCookie: function(name) {
        document.cookie = name +'=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;';
    },

    // Vertical / Horizontal Layout
    ManageThemeLayout: function () {
      switch (settings.Layout) {
        case "horizontal":
          $("#horizontal-layout").prop("checked", !0);
          $("html").attr("data-layout", "horizontal");

          break;
        case "vertical":
          $("#vertical-layout").prop("checked", !0);
          $("html").attr("data-layout", "vertical");
          break;
        default:
      }
    },

    //****************************
    // Full / Minisidebar type
    //****************************
    ManageSidebarType: function () {

      let sidebar = AdminSettings.getCookie("sidebar");
      if (sidebar) {
        settings.SidebarType = sidebar;
      }

      switch (settings.SidebarType) {
        //****************************
        // If the sidebar type has full
        //****************************
        case "full":
          $("#full-sidebar").prop("checked", !0);
          this.setCookie("sidebar", "full", 365);
          $("body").attr("data-sidebartype", "full");
          //****************************
          /* This is for the mini-sidebar if width is less then 1170*/
          //****************************
          var setsidebartype = function () {
            var width =
              window.innerWidth > 0 ? window.innerWidth : this.screen.width;
            if (width < 1300) {
              $("body").attr("data-sidebartype", "mini-sidebar");
            } else {
              $("body").attr("data-sidebartype", "full");
            }
          };
          $(window).on("ready", setsidebartype);
          $(window).on("resize", setsidebartype);
          break;

        //****************************
        // If the sidebar type has mini-sidebar
        //****************************
        case "mini-sidebar":
          $("#mini-sidebar").prop("checked", !0);
          this.setCookie("sidebar", "mini-sidebar", 365);
          $("body").attr("data-sidebartype", "mini-sidebar");

          break;

        default:
      }
    },
    //****************************
    // Layout Boxed or Full
    //****************************
    ManageBoxedLayout: function () {
      $("#boxed-layout").prop("checked", !0);
      switch (settings.BoxedLayout) {
        case true:
          $("html").attr("data-boxed-layout", "boxed");
          $("#boxed-layout").prop("checked", !0);
          break;
        case false:
          $("html").attr("data-boxed-layout", "full");
          $("#full-layout").prop("checked", !0);
          break;
        default:
      }
    },
    //****************************
    // Direction Type
    //****************************
    ManageDirectionLayout: function () {
      //$("#ltr-layout").prop("checked", !0);
      switch (settings.Direction) {
        case "ltr":
          $("#ltr-layout").prop("checked", !0);
          $("html").attr("dir", "ltr");
          $(".offcanvas-start")
            .toggleClass("offcanvas-end")
            .removeClass("offcanvas-start");
          $("#ltr-layout").prop("checked", !0);
          break;
        case "rtl":
          $("html").attr("dir", "rtl");
          $(".offcanvas-end")
            .toggleClass("offcanvas-start")
            .removeClass("offcanvas-end");
          $("#rtl-layout").prop("checked", !0);
          break;
        default:
      }
    },

    //****************************
    // Carc Type
    //****************************
    ManageCardLayout: function () {
      $("#card-without-border").prop("checked", !0);
      switch (settings.cardBorder) {
        case true:
          $("html").attr("data-card", "border");
          $("#card-with-border").prop("checked", !0);
          break;
        case false:
          $("html").attr("data-card", "shadow");
          $("#card-without-border").prop("checked", !0);

          break;
        default:
      }
    },

    //****************************
    // Theme Dark or light
    //****************************
    ManageDarkThemeLayout: function () {
      let theme = AdminSettings.getCookie("theme");
      if (theme) {
        settings.Theme = theme;
      }
      switch (settings.Theme) {
        case "light":
          $("#light-layout").prop("checked", !0);
          $("html").attr("data-bs-theme", "light");
          $("#light-layout").prop("checked", !0);
          $(".light-logo").hide();
          $(".dark-logo").show();
          break;
        case "dark":
          $("html").attr("data-bs-theme", "dark");
          $("#dark-layout").prop("checked", !0);
          $(".dark-logo").hide();
          $(".light-logo").show();
          break;
        default:
      }
    },

    ManageColorThemeLayout: function () {
      switch (settings.ColorTheme) {
        case settings.ColorTheme:
          $("html").attr("data-color-theme", settings.ColorTheme);
          $("#" + settings.ColorTheme).prop("checked", !0);
          break;
        default:
      }
    },
  };
  AdminSettings.AdminSettingsInit();
};

$(function () {
  //****************************
  // Theme Direction RTL LTR click
  //****************************
  function handleDirection() {
    $("#rtl-layout").on("click", function () {
      $("html").attr("dir", "rtl");
      $(".offcanvas-end")
        .toggleClass("offcanvas-start")
        .removeClass("offcanvas-end");
      $(this).is(":checked");
    });
    $("#ltr-layout").on("click", function () {
      $("html").attr("dir", "ltr");
      $(".offcanvas-start")
        .toggleClass("offcanvas-end")
        .removeClass("offcanvas-start");
    });
  }
  handleDirection();

  // unified cookie helpers
  function setSettingsCookie(updates, days = 365) {
    let all = JSON.parse(getSettingsCookie() || "{}");
    Object.assign(all, updates);
    var date = new Date();
    date.setTime(date.getTime() + days * 24 * 60 * 60 * 1000);
    var expires = "; expires=" + date.toUTCString();
    document.cookie = "adminSettings=" + JSON.stringify(all) + expires + "; path=/";
    console.log("set cookie", all);
  }
  function getSettingsCookie() {
    var nameEQ = "adminSettings=";
    var ca = document.cookie.split(";");
    for (var i = 0; i < ca.length; i++) {
      var c = ca[i];
      while (c.charAt(0) == " ") c = c.substring(1, c.length);
      if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
    }
    return null;
  }
  function getSettings() {
    let raw = getSettingsCookie();
    console.log("get cookie", raw);
    return raw ? JSON.parse(raw) : {};
  }

  //****************************
  // Theme Layout Box or Full
  //****************************
  function handleboxedlayout() {
    $("#boxed-layout").on("click", function () {
      $(".container-fluid").removeClass("mw-100");
      $(this).is(":checked");
      $("html").attr("data-boxed-layout", "boxed");
      setSettingsCookie({ BoxedLayout: true });
    });
    $("#full-layout").on("click", function () {
      $(".container-fluid").addClass("mw-100");
      $("html").attr("data-boxed-layout", "full");
      $(this).is(":checked");
      setSettingsCookie({ BoxedLayout: false });
    });
  }
  handleboxedlayout();

  //****************************
  // Theme Layout Vertical or horizontal
  //****************************
  function handleLayout() {
    $("#vertical-layout").on("click", function () {
      $("html").attr("data-layout", "vertical");
      $(this).is(":checked");
      setSettingsCookie({ Layout: "vertical" });
    });
    $("#horizontal-layout").on("click", function () {
      $("html").attr("data-layout", "horizontal");
      $(this).is(":checked");
      setSettingsCookie({ Layout: "horizontal" });
    });
  }
  handleLayout();

  //****************************
  // Theme mode dark or light
  //****************************
  function handleTheme() {
    $("#dark-layout").on("click", function () {
      $("html").attr("data-bs-theme", "dark");
      $(".dark-logo").hide();
      $(".light-logo").show();
      setSettingsCookie({ Theme: "dark" });
    });
    $("#light-layout").on("click", function () {
      $("html").attr("data-bs-theme", "light");
      $(".light-logo").hide();
      $(".dark-logo").show();
      setSettingsCookie({ Theme: "light" });
    });

    // apply stored theme on load after DOM ready
    $(function () {
      let s = getSettings();
      console.log("handleTheme: loaded settings", s.Theme);
      if (s.Theme === "dark") {
        $("html").attr("data-bs-theme", "dark");
        $("#dark-layout").prop("checked", !0);
        $(".dark-logo").hide();
        $(".light-logo").show();
      } else {
        $("html").attr("data-bs-theme", "light");
        $("#light-layout").prop("checked", !0);
        $(".light-logo").hide();
        $(".dark-logo").show();
      }
    });
  }
  handleTheme();

  //****************************
  // Theme card with border or shadow
  //****************************
  function handlecardlayout() {
    $("#card-with-border").on("click", function () {
      $("html").attr("data-card", "border");
      setSettingsCookie({ cardBorder: true });
    });
    $("#card-without-border").on("click", function () {
      $("html").attr("data-card", "shadow");
      setSettingsCookie({ cardBorder: false });
    });
  }
  handlecardlayout();

  //****************************
  // Theme sidebar toggle
  //****************************
  function handlesidebartoggle() {
    $("#full-sidebar").on("click", function () {
      $("body").attr("data-sidebartype", "full");
      setSettingsCookie({ SidebarType: "full" });
    });
    $("#mini-sidebar").on("click", function () {
      $("body").attr("data-sidebartype", "mini-sidebar");
      setSettingsCookie({ SidebarType: "mini-sidebar" });
    });

    // apply stored sidebar type on load after DOM ready
    $(function () {
      let s = getSettings();
      console.log("handlesidebartoggle: loaded settings", s);
      if (s.SidebarType === "mini-sidebar") {
        $("body").attr("data-sidebartype", "mini-sidebar");
        $("#mini-sidebar").prop("checked", !0);
      } else {
        $("body").attr("data-sidebartype", "full");
        $("#full-sidebar").prop("checked", !0);
      }
    });
  }
  handlesidebartoggle();

  function handlesidebar() {
    $(".sidebartoggler").on("click", function () {
      $(".sidebartoggler").prop("checked", !0);
      $("#main-wrapper").toggleClass("show-sidebar");
      var dataTheme = $("body").attr("data-sidebartype");
      if (dataTheme == "full") {
        $("body").attr("data-sidebartype", "mini-sidebar");
        setSettingsCookie({ SidebarType: "mini-sidebar" });
      } else {
        $("body").attr("data-sidebartype", "full");
        setSettingsCookie({ SidebarType: "full" });
      }
    });
  }
  handlesidebar();

  //****************************
  // Theme Color selection
  //****************************
  function handleColorTheme() {
    $("[name=color-theme-layout]").on("click", function () {
      var theme = $(this).attr("id");
      document.documentElement.setAttribute("data-color-theme", theme);
      setSettingsCookie({ ColorTheme: theme });
    });
    // apply stored on load after DOM ready
    $(function () {
      let s = getSettings();
      console.log("handleColorTheme: loaded settings", s);
      if (s.ColorTheme) {
        document.documentElement.setAttribute("data-color-theme", s.ColorTheme);
        $("#" + s.ColorTheme).prop("checked", !0);
      } else {
        document.documentElement.setAttribute("data-color-theme", "Blue_Theme");
        $("#Blue_Theme").prop("checked", !0);
      }
    });
  }

  handleColorTheme();

  //****************************
  // Size Layout Cozy / Comfy / Compact
  //****************************
  function handleSizeLayout() {
    $("#cozy-layout").on("click", function () {
      $("html").attr("data-density", "cozy");
      setSettingsCookie({ SizeLayout: "cozy" });
    });
    $("#comfy-layout").on("click", function () {
      $("html").attr("data-density", "comfortable");
      setSettingsCookie({ SizeLayout: "comfortable" });
    });
    $("#compact-layout").on("click", function () {
      $("html").attr("data-density", "compact");
      setSettingsCookie({ SizeLayout: "compact" });
    });
    // apply stored on load
    $(function () {
      let s = getSettings();
      console.log("handleSizeLayout: loaded settings", s.SizeLayout);
      if (s.SizeLayout) {
        $("html").attr("data-density", s.SizeLayout);
        $("#size-" + s.SizeLayout).prop("checked", !0);
      } else {
        $("html").attr("data-density", "cozy");
        $("#size-cozy").prop("checked", !0);
      }
    });
  }

  handleSizeLayout();

  window.handleSizeLayoutCmd = function(layout) {
    $("html").attr("data-density", layout);
    setSettingsCookie({ SizeLayout: layout });
  }

});
